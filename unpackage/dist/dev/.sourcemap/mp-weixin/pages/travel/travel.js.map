{"version":3,"sources":["uni-app:///main.js","webpack:///E:/current-project/retirement/retirement/pages/travel/travel.vue?efd1","webpack:///E:/current-project/retirement/retirement/pages/travel/travel.vue?ebe0","webpack:///E:/current-project/retirement/retirement/pages/travel/travel.vue?f6a7","webpack:///E:/current-project/retirement/retirement/pages/travel/travel.vue?1918","uni-app:///pages/travel/travel.vue","webpack:///E:/current-project/retirement/retirement/pages/travel/travel.vue?74b4","webpack:///E:/current-project/retirement/retirement/pages/travel/travel.vue?bc86"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","data","messageList","userInfo","imgUrl","socket","userChats","groupChats","friendPhone","friends","notificattions","ifNext","group","groupName","groupAvatar","uploadUrl","isInvited","groupFriend","filters","formatTimeToHourMinute","onShow","console","url","success","that","uni","methods","gotoChat","openFileSelector","CreateGroup","filePath","name","formData","header","invite","item","Gclose","initiateGroup","Fup","getFriendInfo","GroupNext","friend","agree","reject","notif","Nclose","close","clear","confirm","title","icon","gotoGroup","messageGroups","getChats","res","getgroups","acc","Object","groupedRes","lastMessage","lastItems","onUnload","getTime"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,eAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+H;AAC/H;AAC0D;AACL;AACqC;;;AAG1F;AAC+K;AAC/K,gBAAgB,sLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6FAAM;AACR,EAAE,sGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,aAAa,oVAEN;AACP,KAAK;AACL;AACA,aAAa,oSAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACzEA;AAAA;AAAA;AAAA;AAA+pB,CAAgB,6pBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;ACkFnrB;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA,eACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACA;;MAEA;MACA;;MAEA;MACA;MACA;;MAEA;MACA;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;IACAC;IACA;IACA;MACAC;MACAC;QACAF;QACAA;MACA;IACA;IACA;IACA;MACA;MACA;QAAA;MAAA;MACAG;MACAA;MAEA;MACAA;IACA;IACAC;MACAJ;IACA;EACA;EACAK,yCACA;IACAC;MACA;MACAF;QACAH;MACA;IACA;IACAM;MAAA;MACAH;QACAF;UACA;UACA;UACA;QACA;MACA;IACA;IACAM;MAAA;MACAJ;QACAH;QAAA;QACAQ;QACAC;QACAC;QACAC;UAAA;QAAA;QACAV;UACA;UACA;UACA;UACA;UACA;YACA;cACA;YACA;UACA;QACA;MACA;IACA;IACAW;MACA;QACAC;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;QAAA;UACAC;UACAzB;QACA;MAAA;MACAK;IACA;IACAqB;MAAA;MACArB;MACA;MACApB;MACAA;MACA;QAAA;UAAA;QAAA;MAAA;IACA;IACA0C;MAAA;MACA;MACA1C;MACAA;MACA;QACA;UAAA;QAAA;MACA;IACA;IACA2C;MAAA;MACA;QACA;QACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA3B;MACA;QAAA;MAAA;MACA;QACA;QACApB;QACAA;QACA;UACAwB;YACAwB;UACA;QACA;MACA;QACAxB;UACAwB;UACAC;QACA;MACA;IAEA;IACAC;MACA9B;MACA;QACA;UACA;UACA;YACA;YACA+B;YACAA;YACA/B;YACAI;cACAH;YACA;UACA;QACA;MACA;IACA;IACA+B;MAAA;MACA;MACA,iDACA;QACA;UAAA;YAEA;YACA;cAAA;YAAA;YACA;YACA;YACA;cAAA;YAAA;YACA;YACA;cACAhC;cACAiC;cACA;cACA;YACA;;YAEA;YACA;YACA;YACA;YACA;UAAA;UAlBA;YAAA;UAmBA;QACA;MACA,EACA;MACA;IACA;IACAC;MAAA;MACA;QACA;UACA;YACAC;UACA;UACAA;UACA;QACA;;QAEA;QACAC;UACA;YACA;UACA;;UAEA;UACAC;QACA;QACA;QACArC;QAEA;UACA;UACA;UACA;YAAA;UAAA;;UAEA;UACAsC;UAEA;QACA;QACAtC;QACAuC;UACA;QACA;QACA;UACA;UACA;UACA;;UAEA;UACA;QACA;QACAvC;MACA;IACA;IACAwC;MACA;IACA;IACAC;MACA;MACA;;MAEA;MACA;MACA;MACA;MACA;MACA;;MAEA;MACA;MAEA;IACA;EAAA;AAEA;AAAA,2B;;;;;;;;;;;;;ACtYA;AAAA;AAAA;AAAA;AAAk+B,CAAgB,47BAAG,EAAC,C;;;;;;;;;;;ACAt/B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/travel/travel.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/travel/travel.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./travel.vue?vue&type=template&id=2f7c86f4&scoped=true&\"\nvar renderjs\nimport script from \"./travel.vue?vue&type=script&lang=js&\"\nexport * from \"./travel.vue?vue&type=script&lang=js&\"\nimport style0 from \"./travel.vue?vue&type=style&index=0&id=2f7c86f4&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2f7c86f4\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/travel/travel.vue\"\nexport default component.exports","export * from \"-!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./travel.vue?vue&type=template&id=2f7c86f4&scoped=true&\"","var components\ntry {\n  components = {\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n    uniFormsItem: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-forms/components/uni-forms-item/uni-forms-item\" */ \"@/uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.vue\"\n      )\n    },\n    uniEasyinput: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput\" */ \"@/uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.messageList, function (item, __i0__) {\n    var $orig = _vm.__get_orig(item)\n    var f0 = _vm._f(\"formatTimeToHourMinute\")(item.createTime)\n    return {\n      $orig: $orig,\n      f0: f0,\n    }\n  })\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event, item) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        item = _temp2.item\n      var _temp, _temp2\n      item.groupName !== undefined ? _vm.gotoGroup(item) : _vm.gotoChat(item)\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./travel.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./travel.vue?vue&type=script&lang=js&\"","<template>\n\t<view style=\"padding: 5rpx;\">\n\t\t<scroll-view scroll-y=\"true\" style=\"height: 92vh;\">\r\n\t\t\t<!-- <image src=\"http://192.168.1.104:8086/common/download?name=anchor.jpg\" mode=\"\" style=\"width: 100px;height: 100px;\"></image> -->\r\n\t\t\t\t\t<view @click=\"item.groupName !== undefined ? gotoGroup(item) : gotoChat(item)\"  class=\"chat_item\" v-for=\"(item) in messageList\" >\r\n\t\t\t\t\t<img v-if=\"item.groupAvatar === undefined\" :src=\"`${imgUrl}/common/download?name=${item.avatar}`\" style=\"width: 160rpx;height: 160rpx;\" alt=\"\">\r\n\t\t\t\t\t<img v-if=\"item.groupAvatar !== undefined \" :src=\"`${imgUrl}/common/download?name=${item.groupAvatar}`\" style=\"width: 160rpx;height: 160rpx;\" alt=\"\">\r\n\t\t\t\t\t<view v-if=\"item.notRead!==0 && item.groupName=== undefined\" style=\"border-radius: 50%;height: 40rpx;width: 40rpx;background-color: red;color: white;text-align: center;font-size: 12px;position: absolute; top: 1%;left: 150rpx;\">{{item.notRead}}</view>\r\n\t\t\t\t\t<view v-if=\"item.groupName === undefined\" style=\"display: flex;flex-direction: column;margin-left: 20rpx;\"><h2 style=\"font-size: 18px;\">{{item.nickName}}</h2>\r\n\r\n\t\t\t\t\t<view v-if=\"item.ifImg ===0\" style=\"font-size: 12px;color: #999999;margin-top: 10rpx;\">{{item.content}}</view>\r\n\t\t\t\t\t<view v-if=\"item.ifImg ===1\" style=\"font-size: 12px;color: #999999;margin-top: 10rpx;\">[图片]</view>\r\n\t\t\t\t\t </view>\t\r\n\t\t\t\t\t<view v-if=\"item.groupName !== undefined\" style=\"display: flex;flex-direction: column;margin-left: 20rpx;\"><h2 style=\"font-size: 18px;\">{{item.groupName}}</h2>\r\n\t\t\t\t\t<view v-if=\"item.ifImg ===0 && item.content !=null\" style=\"font-size: 12px;color: #999999;margin-top: 10rpx;\">{{item.nickName}}:{{item.content}}</view>\r\n\t\t\t\t\t<view v-if=\"item.ifImg ===1\" style=\"font-size: 12px;color: #999999;margin-top: 10rpx;\">{{item.nickName}}:[图片]</view>\r\n\t\t\t\t\t </view>\r\n\t\t\t\t\t <view style=\"margin-left: auto;margin-bottom: auto;margin-top: 20rpx;color: #999999;\">{{item.createTime | formatTimeToHourMinute}}</view>\r\n\t\t\t</view>\r\n\t\t</scroll-view>\r\n\t\t<view style=\"height: 8vh;display: flex;\">\r\n\t\t\t<button @click=\"notif\" style=\"width: 32.5vw;\">好友请求</button>\r\n\t\t\t<button @click=\"Fup\" style=\"width: 32.5vw;\">好友列表</button>\r\n\t\t\t<button @click=\"initiateGroup\" style=\" width: 32.5vw;\">发起群聊</button>\r\n\t\t </view>\r\n\t\t <uni-popup ref=\"popup\" type=\"bottom\" :maskClick=\"false\">\r\n\t\t\t <scroll-view scroll-y=\"true\" style=\"height: 80vh;background-color: #fff;padding: 5rpx;\">\r\n\t\t\t\t <view style=\"display: flex;margin-bottom: 5rpx;\"><uni-icons style=\"margin-left: auto;margin-right: 10rpx;\" @click=\"close()\" type=\"closeempty\" size=\"30\"></uni-icons></view>\r\n\t\t\t\t <view class=\"friend_item\" v-for=\"(item,index) in friends\" :key=\"index\">\r\n\t\t\t\t\t\t<img v-if=\"item.groupAvatar === undefined\" :src=\"`${imgUrl}/common/download?name=${item.avatar}`\" style=\"width: 130rpx;height: 130rpx;\" alt=\"\">\r\n\t\t\t\t\t\t<view>{{item.nickName}}</view>\r\n\t\t\t\t </view>\r\n\t\t\t</scroll-view>\r\n\t\t \t<view style=\"width: 100vw; height: 15vh;background-color: #fff; padding: 5px; position: absolute;bottom: 0%;\" >\r\n\t\t \t\t\t<uni-forms-item label=\"添加:\" name=\"age\">\r\n\t\t \t\t\t\t<view style=\"display: flex;padding: 5rpx;\"><uni-easyinput type=\"text\" v-model=\"friendPhone\" placeholder=\"请输入账号\"/>\r\n\t\t\t\t\t\t<uni-icons style=\"margin-right: 10rpx;\" @click=\"confirm()\" type=\"plusempty\" size=\"30\"></uni-icons></view>\r\n\t\t \t\t\t</uni-forms-item>\r\n\t\t \t</view>\r\n\t\t </uni-popup>\r\n\t\t <uni-popup ref=\"Npopup\" type=\"bottom\" :maskClick=\"false\">\r\n\t\t\t <scroll-view scroll-y=\"true\" style=\"height: 80vh;background-color: #fff;padding: 5rpx;\">\r\n\t\t\t\t <view style=\"display: flex;margin-bottom: 5rpx;\"><uni-icons style=\"margin-left: auto;margin-right: 10rpx;\" @click=\"Nclose()\" type=\"closeempty\" size=\"30\"></uni-icons></view>\r\n\t\t\t\t <view class=\"friend_item\" v-for=\"(item,index) in notificattions\" :key=\"index\">\r\n\t\t\t\t\t\t<img  :src=\"`${imgUrl}/common/download?name=${item.avatar}`\" style=\"width: 130rpx;height: 130rpx;\" alt=\"\">\r\n\t\t\t\t\t\t<view>{{item.nickName}}</view>\r\n\t\t\t\t\t\t<view style=\"margin-left: auto;margin-right: 10rpx;display: flex;\"><button type=\"primary\" @click=\"agree(item)\">同意</button><button @click=\"reject(item)\" >拒绝</button></view>\r\n\t\t\t\t </view>\r\n\t\t\t</scroll-view>\r\n\t\t </uni-popup> \r\n\t\t <uni-popup ref=\"Gpopup\" type=\"bottom\" :maskClick=\"false\">\r\n\t\t\t\t<view v-if=\"!ifNext\" style=\"width: 100vw; height: 30vh;background-color: #fff; padding: 5px; position: absolute;bottom: 0%;\" >\r\n\t\t\t\t\t\t<uni-forms-item label=\"群聊名:\">\r\n\t\t\t\t\t\t\t<uni-easyinput type=\"text\" v-model=\"group.groupName\" placeholder=\"请输入群聊名\"/>\r\n\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t<uni-forms-item label=\"群头像:\">\r\n\t\t\t\t\t\t\t<img @click=\"openFileSelector\" :src=\"group.groupAvatar\" style=\"width: 50rpx;height: 50rpx;margin-left: 10rpx;\" alt=\"\">\r\n\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t<view style=\"display: flex;justify-content: space-around;\">\r\n\t\t\t\t\t\t\t<button @click=\"Gclose\" style=\"width: 48vw;\">取消</button>\r\n\t\t\t\t\t\t\t<button @click=\"GroupNext\" style=\"width: 48vw;\">下一步</button>\t\t\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view v-if=\"ifNext\">\r\n\t\t\t\t\t<scroll-view   scroll-y=\"true\" style=\"height: 80vh;background-color: #fff;padding: 5rpx;\">\r\n\t\t\t\t\t <view class=\"friend_item\" v-for=\"(item,index) in friends\" :key=\"index\">\r\n\t\t\t\t\t\t\t<img  :src=\"`${imgUrl}/common/download?name=${item.avatar}`\" style=\"width: 130rpx;height: 130rpx;\" alt=\"\">\r\n\t\t\t\t\t\t\t<view>{{item.nickName}}</view>\r\n\t\t\t\t\t\t\t<view style=\"margin-left: auto;margin-right: 10rpx;\"> <button :disabled=\"item.isInvited\" @click=\"invite(item)\">{{ item.isInvited ? '已邀请' : '邀请' }}</button></view>\r\n\t\t\t\t\t </view>\r\n\t\t\t\t\t</scroll-view>\r\n\t\t\t\t\t<view style=\"display: flex;justify-content: space-around;background-color: #fff;\">\r\n\t\t\t\t\t\t<button @click=\"Gclose\" style=\"width: 49vw;\">取消</button>\r\n\t\t\t\t\t\t<button @click=\"CreateGroup\" style=\"width: 49vw;\">创建</button>\t\t\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\r\n\t\t </uni-popup>\n\t</view>\n</template>\n\n<script>\r\n\timport {getChats} from '../../api/message.js'\r\n\timport {getUser} from '../../api/user.js'\r\n\timport config from '../../common/config.js'\r\n\timport { mapActions } from 'vuex';\r\n\timport {uploadUrl} from '../../api/img.js'\r\n\timport {saveGroup,saveGroupUser,getChatGroups} from'../../api/chatGroup.js'\r\n\timport {getFriends,addFriends,notifications,deleteFriend} from '../../api/friend.js'\n \texport default {\n\t\tdata() {\n\t\t\treturn {\n\t\t\t\tmessageList:[],\r\n\t\t\t\tuserInfo:[],\r\n\t\t\t\timgUrl: '',\r\n\t\t\t\tsocket:'',\r\n\t\t\t\tuserChats:[],\r\n\t\t\t\tgroupChats:[],\r\n\t\t\t\tfriendPhone:'',\r\n\t\t\t\tfriends:[],\r\n\t\t\t\tnotificattions:[],\r\n\t\t\t\tifNext:false,\r\n\t\t\t\tgroup:{\r\n\t\t\t\t\tgroupName:'',\r\n\t\t\t\t\tgroupAvatar: ''\r\n\t\t\t\t},\r\n\t\t\t\tuploadUrl:uploadUrl,\r\n\t\t\t\t isInvited: false,\r\n\t\t\t\tgroupFriend:[], \n\t\t\t}\n\t\t},\r\n\t\t  filters: {\r\n\t\t    formatTimeToHourMinute(value) {\r\n\t\t      if (!value) return '';\r\n\t\t      \r\n\t\t      // 将字符串转换为日期对象\r\n\t\t      var date = new Date(value);\r\n\t\t      \r\n\t\t      // 提取小时和分钟，并确保两位数显示\r\n\t\t      var hours = (\"0\" + date.getHours()).slice(-2);\r\n\t\t      var minutes = (\"0\" + date.getMinutes()).slice(-2);\r\n\t\t\r\n\t\t      // 返回格式化后的时分\r\n\t\t      return hours + \":\" + minutes;\r\n\t\t    }\r\n\t\t  },\r\n\t\tonShow() {\r\n\t\t\tthis.userInfo  =\tuni.getStorageSync('user')\r\n\t\t\tthis.imgUrl = config.APP_SERVER_URL\r\n\t\t\tthis.getChats()\r\n\t\t\tthis.group.groupAvatar = this.imgUrl + '/common/download?name='+'img.png'\r\n\t\t\tconsole.log(this.group.groupAvatar ,'tgg');\r\n\t\t\t// this.getgroups()\n\t\t\tthis.socket = uni.connectSocket({\r\n\t\t\turl: config.WS_SERVER_URL + '/imserver/' + this.userInfo.phone,\r\n\t\t\tsuccess: res => {\r\n\t\t\tconsole.log(res, 'res');\r\n\t\t\tconsole.info('创建连接成功');\r\n\t\t}\r\n      })\n      let that = this;\n      this.socket.onMessage(function (event) {\n        let resOb = JSON.parse(event.data);\n        let cureentID = that.messageList.findIndex(item => item.from === resOb.from);\n        that.messageList[cureentID].content = resOb.message;\n        that.messageList[cureentID].notRead = that.messageList[cureentID].notRead + 1;\n\n        let ctime = that.getTime();\n        that.messageList[cureentID].createTime = ctime;\n      });\r\n\t  uni.onSocketClose(function (res) {\r\n\t    console.log('WebSocket 已关闭！');\r\n\t  });\r\n\t\t},\n\t\tmethods: {\r\n\t\t\t ...mapActions(['initWebSocket']),\n\t\t\tgotoChat(item){\r\n\t\t\t\tthis.socket.close();\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"/pages/chat/chat?item=\"+ encodeURIComponent(JSON.stringify(item))\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\topenFileSelector(){\r\n\t\t\t\tuni.chooseImage({\r\n\t\t\t\t\tsuccess: (chooseImageRes) => {\r\n\t\t\t\t\t\tconst tempFilePaths = chooseImageRes.tempFilePaths;\r\n\t\t\t\t\t\tlet filePath = tempFilePaths[0]\r\n\t\t\t\t\t\tthis.group.groupAvatar = filePath\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tCreateGroup(){\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\turl: uploadUrl, //仅为示例，非真实的接口地址\r\n\t\t\t\t\tfilePath: this.group.groupAvatar,\r\n\t\t\t\t\tname: 'file',\r\n\t\t\t\t\tformData:{},\r\n\t\t\t\t\theader:{\"Content-Type\": \"multipart/form-data\"},\r\n\t\t\t\t\tsuccess: (uploadFileRes) => {\r\n\t\t\t\t\t\tlet uploadResObject =  JSON.parse(uploadFileRes.data)\r\n\t\t\t\t\t\tlet fileName = uploadResObject.data.substring(uploadResObject.data.lastIndexOf('/') + 1);\r\n\t\t\t\t\t\tthis.group.groupAvatar = fileName\r\n\t\t\t\t\t\tthis.groupFriend.push(this.userInfo.phone)\r\n\t\t\t\t\t\tsaveGroup(this.group.groupName,this.group.groupAvatar).then(res =>{\r\n\t\t\t\t\t\t\t\tif(res!== -1){\r\n\t\t\t\t\t\t\t\t\tsaveGroupUser(res,this.groupFriend)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tinvite(item){\r\n\t\t\t\tif (!item.isInvited) {\r\n\t\t\t\t    item.isInvited = true;\r\n\t\t\t\t\tthis.groupFriend.push(item.phone)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tGclose(){\r\n\t\t\t\tthis.$refs.Gpopup.close()\r\n\t\t\t\tthis.group.groupAvatar=this.imgUrl + '/common/download?name='+'img.png'\r\n\t\t\t\tthis.group.groupName=''\r\n\t\t\t\tthis.ifNext = false\r\n\t\t\t\tthis.groupFriend=[]\r\n\t\t\t},\r\n\t\t\tinitiateGroup(){\t\r\n\t\t\t\tthis.$refs.Gpopup.open()\r\n\t\t\t},\r\n\t\t\tFup(){\r\n\t\t\t\tthis.getFriendInfo()\r\n\t\t\t\tthis.$refs.popup.open()\r\n\t\t\t},\r\n\t\t\tgetFriendInfo(){\r\n\t\t\t\tgetFriends(this.userInfo.phone).then(res =>{\r\n\t\t\t\t\tthis.friends = res \r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tGroupNext(){\r\n\t\t\t\tthis.ifNext = true\r\n\t\t\t\tthis.getFriendInfo()\r\n\t\t\t\tthis.friends.map(friend => ({\r\n\t\t\t\t        friend,\r\n\t\t\t\t        isInvited: false,\r\n\t\t\t\t      }))\r\n\t\t\t\tconsole.log(this.friends,'tfr');\r\n\t\t\t},\r\n\t\t\tagree(item){\r\n\t\t\t\tconsole.log(item,'itm');\r\n\t\t\t\tlet data={}\r\n\t\t\t\tdata.userId= this.userInfo.phone\r\n\t\t\t\tdata.friendId = item.phone\r\n\t\t\t\taddFriends(data).then(res =>{this.notificattions =\tthis.notificattions.filter(itx => (itx.phone !== item.phone))})\r\n\t\t\t},\r\n\t\t\treject(item){\r\n\t\t\t\tlet data={}\r\n\t\t\t\tdata.userId= item.phone\r\n\t\t\t\tdata.friendId = this.userInfo.phone\r\n\t\t\t\tdeleteFriend(data).then(res =>{\r\n\t\t\t\tthis.notificattions =\tthis.notificattions.filter(itx => (itx.phone !== item.phone))\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tnotif(){\r\n\t\t\t\tnotifications(this.userInfo.phone).then(res =>{\r\n\t\t\t\t\tthis.notificattions = res\r\n\t\t\t\t\tthis.$refs.Npopup.open()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tNclose(){\r\n\t\t\t\tthis.$refs.Npopup.close()\r\n\t\t\t},\r\n\t\t\tclose() {\r\n\t\t\t\t\tthis.clear()\r\n\t\t\t\t\tthis.$refs.popup.close()\r\n\t\t\t\t\t},\r\n\t\t\tclear(){\r\n\t\t\t\tthis.friendPhone = ''\r\n\t\t\t},\t\t\r\n\t\t\tconfirm() {\r\n\t\t\t\tconsole.log(this.friendPhone,'friendPhone');\r\n\t\t\t\tlet friendIndex = this.friends.findIndex((friend) => friend.phone === this.friendPhone);\r\n\t\t\t\tif(friendIndex===-1){\r\n\t\t\t\t\tlet data={}\r\n\t\t\t\t\tdata.userId= this.userInfo.phone\r\n\t\t\t\t\tdata.friendId = this.friendPhone\r\n\t\t\t\t\taddFriends(data).then(res =>{\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle:'已发送好友请求'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle:'该好友已添加',\r\n\t\t\t\t\t\ticon:'error'\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tgotoGroup(item){\r\n\t\t\t\tconsole.log(this.groupChats);\r\n\t\t\t\tfor (const groupId in this.groupChats) {\r\n\t\t\t\t\tif (Object.prototype.hasOwnProperty.call(this.groupChats, groupId) && Array.isArray(this.groupChats[groupId])) {\r\n\t\t\t\t\t\t  const lastMessage = this.groupChats[groupId][this.groupChats[groupId].length - 1];\r\n\t\t\t\t\t\t  if (lastMessage && lastMessage.groupId === item.groupId) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet messageGroups = this.groupChats[groupId]\r\n\t\t\t\t\t\t\t\t\t\t\tmessageGroups.groupName = item.groupName\r\n\t\t\t\t\t\t\t\t\t\t\tmessageGroups.groupId = item.groupId\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(messageGroups,'mgp');\r\n\t\t\t\t\t\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t\t\t\t\t\turl:'/pages/chat/groupChat?groups='+ encodeURIComponent(JSON.stringify(messageGroups))\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t  }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t  }\r\n\t\t\t},\r\n\t\t\tgetChats(){\r\n\t\t\t\tthis.messageList = []\r\n\t\t\t\tgetChats(this.userInfo.phone).then(\r\n\t\t\t\t\tres=>{\r\n\t\t\t\t\t\tif(res.code ===1){\r\n\t\t\t\t\t\t\tfor (var key in res.data) {\r\n\t\t\t\t\t\t\t\tlet messageValue =  res.data[key]\r\n\t\t\t\t\t\t\t\tlet notRead= messageValue.filter(item => (item.ifReceive ===0 && item.to === this.userInfo.phone))\r\n\t\t\t\t\t\t\t\tlet lastMessage =  messageValue[messageValue.length-1]\r\n\t\t\t\t\t\t\t\tconst newKey = key.split('-')\r\n\t\t\t\t\t\t\t\tlet filterKey = newKey.filter(item => item !== this.userInfo.phone)\r\n\t\t\t\t\t\t\t\t// console.log(filterKey);\r\n\t\t\t\t\t\t\t\tgetUser(filterKey).then(res =>{\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(res.data,'ress');\r\n\t\t\t\t\t\t\t\t\t\tres.data.notRead = notRead.length \r\n\t\t\t\t\t\t\t\t\t\tvar mergedObject = { ...lastMessage, ...res.data};\r\n\t\t\t\t\t\t\t\t\t\tthis.messageList.push(mergedObject)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// request.get('/user/getUserByAccount?account='+filterKey).then(\r\n\t\t\t\t\t\t\t\t// res=>{\r\n\t\t\t\t\t\t\t\t// \tvar mergedObject = { ...lastMessage, ...res.data.data };\r\n\t\t\t\t\t\t\t\t// \tmessageList.value.push(mergedObject)\r\n\t\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t)\r\n\t\t\t\tthis.getgroups()\r\n\t\t\t},\r\n\t\t\tgetgroups(){\r\n\t\t\t\tgetChatGroups(this.userInfo.phone).then(res =>{\r\n\t\t\t\t\tlet groupedRes = res.reduce((acc, curr) => {\r\n\t\t\t\t\t  if (!acc[curr.groupId]) {\r\n\t\t\t\t\t    acc[curr.groupId] = [];\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t  acc[curr.groupId].push(curr);\r\n\t\t\t\t\t  return acc;\r\n\t\t\t\t\t}, {});\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 然后遍历分组后的结果，统计每个组中未读消息数量，并添加到原始对象上\r\n\t\t\t\t\tObject.keys(groupedRes).forEach(groupId => {\r\n\t\t\t\t\t  let noReadCount = groupedRes[groupId].reduce((acc, curr) => {\r\n\t\t\t\t\t    return acc + (curr.ifReceive === 0 ? 1 : 0);\r\n\t\t\t\t\t  }, 0);\r\n\t\t\t\t\t\r\n\t\t\t\t\t  // 添加一个新属性来记录该组的未读消息数量\r\n\t\t\t\t\t  groupedRes[groupId].notRead = noReadCount;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.groupChats = groupedRes\r\n\t\t\t\t\tconsole.log(groupedRes);\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet lastItems = Object.keys(groupedRes).map(groupId => {\r\n\t\t\t\t\t  let lastMessage = groupedRes[groupId][groupedRes[groupId].length-1];\r\n\t\t\t\t\t  // 获取未读消息数量\r\n\t\t\t\t\t  let unreadCount = groupedRes[groupId].reduce((acc, curr) => acc + (curr.ifReceive === 0 ? 1 : 0), 0);\r\n\t\t\t\t\t\r\n\t\t\t\t\t  // 将未读消息数量添加到最后一条消息对象中\r\n\t\t\t\t\t  lastMessage.notRead = unreadCount;\r\n\t\t\t\t\t\r\n\t\t\t\t\t  return lastMessage;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log(lastItems);\r\n\t\t\t\t\tlastItems.forEach((item,index) => {\r\n\t\t\t\t\t  this.messageList.push(item);\r\n\t\t\t\t\t});\t\r\n\t\t\t\t\tthis.messageList.sort((a, b) => {\r\n\t\t\t\t\t  // 将字符串时间转换为Date对象以比较\r\n\t\t\t\t\t  const dateA = new Date(a.create_time);\r\n\t\t\t\t\t  const dateB = new Date(b.create_time);\r\n\t\t\t\t\t\r\n\t\t\t\t\t  // 升序排列：较早的时间排在前面\r\n\t\t\t\t\t  return dateB - dateA;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.log(this.messageList,'ts');\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tonUnload(){\r\n\t\t\t \tthis.socket.close()\r\n\t\t\t},\r\n\t\t\tgetTime(){\r\n\t\t\t // 获取当前时间\r\n\t\t\t  var now = new Date();\r\n\t\t\t\r\n\t\t\t  // 提取年、月、日、小时和分钟\r\n\t\t\t  var year = now.getFullYear();\r\n\t\t\t  var month = (\"0\" + (now.getMonth() + 1)).slice(-2); // 注意：getMonth()返回的是0-11的数字，需要加1\r\n\t\t\t  var day = (\"0\" + now.getDate()).slice(-2);\r\n\t\t\t  var hours = (\"0\" + now.getHours()).slice(-2);\r\n\t\t\t  var minutes = (\"0\" + now.getMinutes()).slice(-2);\r\n\t\t\t\r\n\t\t\t  // 格式化输出为 年-月-日 时:分\r\n\t\t\t  var currentTimeFormatted = year + \"-\" + month + \"-\" + day + \" \" + hours + \":\" + minutes;\r\n\t\t\t\r\n\t\t\t  return currentTimeFormatted;\r\n\t\t\t}\n\t\t}\n\t}\n</script>\n\n<style scoped>\n.chat_item{\r\n\t\theight: 15vh;\r\n\t\tborder-bottom:1px solid #f4f4f4 ;\r\n\t\tpadding: 20rpx;\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n.friend_item{\r\n\theight: 10vh;\r\n\tborder-bottom:1px solid #f4f4f4 ;\r\n\tpadding: 10rpx;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\t\n</style>\n","import mod from \"-!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./travel.vue?vue&type=style&index=0&id=2f7c86f4&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./travel.vue?vue&type=style&index=0&id=2f7c86f4&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1719293287816\n      var cssReload = require(\"E:/hbuilder/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}